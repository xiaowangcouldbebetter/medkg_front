"use strict";(self["webpackChunkhisclient"]=self["webpackChunkhisclient"]||[]).push([[921],{6921:function(e,s,t){t.r(s),t.d(s,{default:function(){return S}});var i=t(6768),a=t(4232),n=t(5130);const o={class:"chat-header"},r={class:"header-right"},l=["title"],d={key:0,xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},c={key:1,xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},p={class:"message-list",ref:"messageList"},v={key:0,class:"welcome-message"},h={class:"suggestion-chips"},u=["onClick"],m={class:"message-avatar"},g={class:"avatar-icon"},k={key:0},f={key:1,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},y={class:"message-wrapper"},w={class:"message-header"},x={class:"message-time"},L=["innerHTML"],E={key:0,class:"message-actions"},C=["onClick"],$={key:1,class:"typing-indicator"},T={class:"input-area"},b={class:"input-wrapper"},M=["disabled"],D=["disabled"],_={key:0,class:"loading-spinner"},X={key:1,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"};function F(e,s,t,F,j,I){return(0,i.uX)(),(0,i.CE)("div",{class:(0,a.C4)(["chat-container",{"dark-mode":j.darkMode}])},[(0,i.Lk)("div",o,[s[6]||(s[6]=(0,i.Fv)('<div class="header-left" data-v-aadde2e6><div class="logo" data-v-aadde2e6><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-aadde2e6><path d="M22 12h-4l-3 9L9 3l-3 9H2" data-v-aadde2e6></path></svg></div></div><div class="header-center" data-v-aadde2e6><h1 data-v-aadde2e6>智能医疗问答系统</h1><div class="header-subtitle" data-v-aadde2e6>基于医疗知识图谱的智能诊疗助手</div></div>',2)),(0,i.Lk)("div",r,[(0,i.Lk)("button",{class:"icon-button",onClick:s[0]||(s[0]=(...e)=>I.toggleDarkMode&&I.toggleDarkMode(...e)),title:j.darkMode?"切换到亮色模式":"切换到暗色模式"},[j.darkMode?((0,i.uX)(),(0,i.CE)("svg",d,s[4]||(s[4]=[(0,i.Fv)('<circle cx="12" cy="12" r="5" data-v-aadde2e6></circle><line x1="12" y1="1" x2="12" y2="3" data-v-aadde2e6></line><line x1="12" y1="21" x2="12" y2="23" data-v-aadde2e6></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64" data-v-aadde2e6></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78" data-v-aadde2e6></line><line x1="1" y1="12" x2="3" y2="12" data-v-aadde2e6></line><line x1="21" y1="12" x2="23" y2="12" data-v-aadde2e6></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36" data-v-aadde2e6></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22" data-v-aadde2e6></line>',9)]))):((0,i.uX)(),(0,i.CE)("svg",c,s[5]||(s[5]=[(0,i.Lk)("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"},null,-1)])))],8,l)])]),(0,i.Lk)("div",p,[0===j.messages.length?((0,i.uX)(),(0,i.CE)("div",v,[s[7]||(s[7]=(0,i.Lk)("div",{class:"welcome-icon"},[(0,i.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,i.Lk)("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),(0,i.Lk)("polyline",{points:"9 22 9 12 15 12 15 22"})])],-1)),s[8]||(s[8]=(0,i.Lk)("h2",null,"欢迎使用医疗问答系统",-1)),s[9]||(s[9]=(0,i.Lk)("p",null,"您可以询问任何医疗相关问题，例如：",-1)),(0,i.Lk)("div",h,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(j.suggestions,((e,s)=>((0,i.uX)(),(0,i.CE)("div",{class:"chip",key:s,onClick:s=>I.useExample(e)},(0,a.v_)(e),9,u)))),128))])])):(0,i.Q3)("",!0),(0,i.bF)(n.F,{name:"message-fade"},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(j.messages,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e.id,class:(0,a.C4)(["message-bubble",e.isUser?"user":"system"])},[(0,i.Lk)("div",m,[(0,i.Lk)("div",g,[e.isUser?((0,i.uX)(),(0,i.CE)("span",k,"您")):((0,i.uX)(),(0,i.CE)("svg",f,s[10]||(s[10]=[(0,i.Lk)("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"},null,-1),(0,i.Lk)("circle",{cx:"12",cy:"7",r:"4"},null,-1)])))])]),(0,i.Lk)("div",y,[(0,i.Lk)("div",w,[(0,i.Lk)("span",null,(0,a.v_)(e.isUser?"您的问题":"系统回复"),1),(0,i.Lk)("span",x,(0,a.v_)(I.formatTime(e.timestamp)),1)]),(0,i.Lk)("div",{class:"message-content",innerHTML:I.formatMessage(e.text)},null,8,L),e.isUser?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",E,[(0,i.Lk)("button",{class:"action-btn",onClick:s=>I.copyToClipboard(e.text),title:"复制回答"},s[11]||(s[11]=[(0,i.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,i.Lk)("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),(0,i.Lk)("path",{d:"M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"})],-1)]),8,C)]))])],2)))),128))])),_:1}),j.isLoading?((0,i.uX)(),(0,i.CE)("div",$,s[12]||(s[12]=[(0,i.Lk)("div",{class:"dot"},null,-1),(0,i.Lk)("div",{class:"dot"},null,-1),(0,i.Lk)("div",{class:"dot"},null,-1)]))):(0,i.Q3)("",!0)],512),(0,i.Lk)("div",T,[(0,i.Lk)("div",b,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>j.inputText=e),placeholder:"请输入您的医疗问题...",onKeyup:s[2]||(s[2]=(0,n.jR)(((...e)=>I.sendMessage&&I.sendMessage(...e)),["enter"])),disabled:j.isLoading,ref:"inputField"},null,40,M),[[n.Jo,j.inputText,void 0,{trim:!0}]]),(0,i.Lk)("button",{disabled:!j.inputText||j.isLoading,onClick:s[3]||(s[3]=(...e)=>I.sendMessage&&I.sendMessage(...e)),class:"send-button"},[j.isLoading?((0,i.uX)(),(0,i.CE)("span",_)):((0,i.uX)(),(0,i.CE)("svg",X,s[13]||(s[13]=[(0,i.Lk)("line",{x1:"22",y1:"2",x2:"11",y2:"13"},null,-1),(0,i.Lk)("polygon",{points:"22 2 15 22 11 13 2 9 22 2"},null,-1)])))],8,D)]),s[14]||(s[14]=(0,i.Lk)("div",{class:"input-footer"},[(0,i.Lk)("span",null,[(0,i.eW)("按 Enter 发送 | "),(0,i.Lk)("kbd",null,"Esc"),(0,i.eW)(" 清空输入框 | "),(0,i.Lk)("kbd",null,"/"),(0,i.eW)(" 查看示例")])],-1))]),j.toast.show?((0,i.uX)(),(0,i.CE)("div",{key:0,class:(0,a.C4)(["toast",j.toast.type])},(0,a.v_)(j.toast.message),3)):(0,i.Q3)("",!0)],2)}t(4114),t(8992),t(3215),t(4520),t(3949),t(7550);var j=t(4373),I={data(){return{inputText:"",messages:[],messageId:0,isLoading:!1,darkMode:!1,suggestions:["糖尿病的症状有哪些？","高血压如何预防？","头痛可能是什么原因？","感冒药和发烧药有什么区别？","如何正确使用抗生素？"],toast:{show:!1,message:"",type:"info",timeout:null}}},mounted(){const e="true"===localStorage.getItem("darkMode");this.darkMode=e,document.addEventListener("keydown",this.handleKeyDown),this.$nextTick((()=>{this.$refs.inputField.focus()}))},beforeDestroy(){document.removeEventListener("keydown",this.handleKeyDown)},methods:{handleKeyDown(e){"Escape"===e.key&&(this.inputText="",this.$refs.inputField.focus()),"/"===e.key&&""===this.inputText&&(e.preventDefault(),this.showToast("请选择下方的示例问题","info"))},useExample(e){this.inputText=e,this.sendMessage()},showToast(e,s="info"){this.toast.timeout&&clearTimeout(this.toast.timeout),this.toast.show=!0,this.toast.message=e,this.toast.type=s,this.toast.timeout=setTimeout((()=>{this.toast.show=!1}),3e3)},copyToClipboard(e){navigator.clipboard.writeText(e).then((()=>{this.showToast("已复制到剪贴板","success")})).catch((e=>{this.showToast("复制失败","error"),console.error("无法复制: ",e)}))},toggleDarkMode(){this.darkMode=!this.darkMode,localStorage.setItem("darkMode",this.darkMode)},formatMessage(e){if(!e)return"";let s=e.replace(/\n/g,"<br>");return s=s.replace(/【(.+?)】/g,'<span class="highlight">$1</span>'),s=s.replace(/属性信息：/g,'<strong class="info-title">属性信息：</strong>'),s=s.replace(/相关信息：/g,'<strong class="info-title">相关信息：</strong>'),s=s.replace(/- (.+)/g,'<div class="list-item">• $1</div>'),s},formatTime(e){if(!e)return"";const s=new Date(e);return`${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}`},findAnswerInData(e){if(!e?.data?.results||0===e.data.results.length)return"很抱歉，暂时没有找到相关信息。请尝试换一种方式提问，或者咨询其他医疗问题。";const s=e.data.results,t=this.detectQuestionType(s);switch(t){case"disease_desc":return this.formatDiseaseDescription(s);case"disease_acompany":return this.formatDiseaseComplication(s);case"disease_do_food":return this.formatDiseaseFood(s);case"disease_symptom":return this.formatDiseaseSymptom(s);case"disease_prevent":return this.formatDiseasePrevent(s);default:return this.formatGeneralResults(s)}},detectQuestionType(e){const s=e[0];return s.properties&&s.properties.desc&&s.properties.desc.length>50?"disease_desc":e.length>3&&e.every((e=>e.relations&&e.relations.some((e=>e.relation&&e.relation.includes("并发症")))))?"disease_acompany":e.some((e=>e.relations&&e.relations.some((e=>e.relation&&(e.relation.includes("宜吃")||e.relation.includes("推荐食谱"))))))?"disease_do_food":e.some((e=>e.relations&&e.relations.some((e=>e.relation&&e.relation.includes("症状")))))?"disease_symptom":e.some((e=>e.relations&&e.relations.some((e=>e.relation&&e.relation.includes("预防")))))?"disease_prevent":"general"},formatDiseaseDescription(e){let s="";const t=e[0];if(t.entity&&(s+=`<div class="entity-title">【${t.entity}】</div>`),t.properties&&t.properties.desc){let e=t.properties.desc.replace(/\\xa0/g," ").trim();const i=e.split("\n").filter((e=>e.trim()));i.forEach((e=>{s+=`<p class="desc-paragraph">${e}</p>`}))}return s||"很抱歉，暂时没有找到相关疾病的描述信息。"},formatDiseaseComplication(e){if(!e||0===e.length)return"未找到相关并发症信息";const s=e[0].entity;let t=`<div class="entity-title">【${s}】的并发症</div>`;const i={from:[],to:[]};return e.forEach((e=>{e.relations&&e.relations.length>0&&e.relations.forEach((e=>{e.source===s?i.from.push(e.target):e.target===s&&i.to.push(e.source)}))})),i.from.length>0&&(t+=`<div class="complication-section">\n          <div class="section-title">${s}可能引起的并发症：</div>\n          <div class="complication-list">`,i.from.slice(0,10).forEach((e=>{t+=`<div class="complication-item">• ${e}</div>`})),i.from.length>10&&(t+=`<div class="complication-more">等${i.from.length}种并发症</div>`),t+="</div></div>"),i.to.length>0&&(t+=`<div class="complication-section">\n          <div class="section-title">可能导致${s}的其他疾病：</div>\n          <div class="complication-list">`,i.to.slice(0,10).forEach((e=>{t+=`<div class="complication-item">• ${e}</div>`})),i.to.length>10&&(t+=`<div class="complication-more">等${i.to.length}种疾病</div>`),t+="</div></div>"),t+='<div class="notice-section">\n        <div class="notice-title">温馨提示：</div>\n        <div class="notice-content">并发症信息仅供参考，具体诊断和治疗请咨询专业医生。</div>\n      </div>',t},formatDiseaseFood(e){if(!e||0===e.length)return"未找到相关饮食信息";const s=e[0].entity;let t=`<div class="entity-title">【${s}】的饮食建议</div>`;const i={recommended:[],recipes:[]};return e.forEach((e=>{e.relations&&e.relations.length>0&&e.relations.forEach((e=>{e.relation&&e.relation.includes("宜吃")?i.recommended.push(e.target):e.relation&&e.relation.includes("推荐食谱")&&i.recipes.push(e.target)}))})),i.recommended.length>0&&(t+='<div class="food-section">\n          <div class="section-title">宜吃食物：</div>\n          <div class="food-grid">',i.recommended.forEach((e=>{t+=`<div class="food-item">\n            <span class="food-icon">🍽️</span>\n            <span class="food-name">${e}</span>\n          </div>`})),t+="</div></div>"),i.recipes.length>0&&(t+='<div class="food-section">\n          <div class="section-title">推荐食谱：</div>\n          <div class="recipe-list">',i.recipes.forEach((e=>{t+=`<div class="recipe-item">\n            <span class="recipe-icon">🍲</span>\n            <span class="recipe-name">${e}</span>\n          </div>`})),t+="</div></div>"),t+='<div class="notice-section">\n        <div class="notice-title">饮食注意事项：</div>\n        <div class="notice-content">合理饮食是控制疾病的重要手段，建议配合医生指导制定个性化饮食方案。</div>\n      </div>',t},formatDiseaseSymptom(e){if(!e||0===e.length)return"未找到相关症状信息";const s=e[0].entity;let t=`<div class="entity-title">【${s}】的症状</div>`;const i=[];return e.forEach((e=>{e.relations&&e.relations.length>0&&e.relations.forEach((e=>{e.relation&&e.relation.includes("症状")&&i.push(e.target)}))})),i.length>0?(t+='<div class="symptom-section">\n          <div class="symptom-list">',i.forEach((e=>{t+=`<div class="symptom-item">• ${e}</div>`})),t+="</div></div>"):t+="<p>未找到相关症状信息</p>",t},formatDiseasePrevent(e){if(!e||0===e.length)return"未找到相关预防信息";const s=e[0].entity;let t=`<div class="entity-title">【${s}】的预防措施</div>`;const i=[];return e.forEach((e=>{e.relations&&e.relations.length>0&&e.relations.forEach((e=>{e.relation&&e.relation.includes("预防")&&i.push(e.target)}))})),i.length>0?(t+='<div class="prevention-section">\n          <div class="prevention-list">',i.forEach(((e,s)=>{t+=`<div class="prevention-item">\n            <div class="prevention-number">${s+1}</div>\n            <div class="prevention-content">${e}</div>\n          </div>`})),t+="</div></div>"):t+="<p>未找到相关预防信息</p>",t},formatGeneralResults(e){let s="";return e.forEach(((e,t)=>{if(t>0&&(s+="\n\n"),e.entity&&(s+=`<div class="entity-title">【${e.entity}】</div>`),e.properties&&Object.keys(e.properties).length>0&&(s+='<div class="properties-section">',s+='<div class="section-title">属性信息：</div>',Object.entries(e.properties).forEach((([e,t])=>{if(t&&"name"!==e)if("desc"===e&&"string"===typeof t&&t.length>100){const i=t.replace(/\\xa0/g," ").split("\n").filter((e=>e.trim()));s+=`<div class="property-item"><span class="property-key">${e}:</span>`,i.forEach((e=>{s+=`<p class="property-value-paragraph">${e}</p>`})),s+="</div>"}else s+=`<div class="property-item">\n                <span class="property-key">${e}:</span>\n                <span class="property-value">${t}</span>\n              </div>`})),s+="</div>"),e.relations&&e.relations.length>0){s+='<div class="relations-section">',s+='<div class="section-title">相关信息：</div>';const t={};e.relations.forEach((e=>{const s=e.relation||"其他";t[s]||(t[s]=[]),t[s].push(e)})),Object.entries(t).forEach((([e,t])=>{s+=`<div class="relation-group">\n              <div class="relation-type">${e}：</div>\n              <div class="relation-items">`,t.forEach((e=>{s+=`<div class="relation-item">• ${e.target||e.source}</div>`})),s+="</div></div>"})),s+="</div>"}})),s||"很抱歉，暂时没有找到相关信息。请尝试换一种方式提问，或者咨询其他医疗问题。"},async sendMessage(){if(this.inputText)try{this.messages.push({id:this.messageId++,text:this.inputText,isUser:!0,timestamp:Date.now()});const e=this.inputText;this.inputText="",this.$nextTick((()=>{this.$refs.inputField.focus()})),this.isLoading=!0,this.scrollToBottom();const s=await j.A.post("http://127.0.0.1:8000/api/qa/",{question:e}),t=s.data?.success?this.findAnswerInData(s.data):"抱歉，服务器处理您的请求时遇到了问题，请稍后再试。";this.messages.push({id:this.messageId++,text:t,isUser:!1,timestamp:Date.now()})}catch(e){console.error(`请求失败：${e.response?.data?.message||e.message}`),this.messages.push({id:this.messageId++,text:"抱歉，连接服务器时遇到了问题。请检查您的网络连接，或稍后再试。",isUser:!1,timestamp:Date.now()})}finally{this.isLoading=!1,this.scrollToBottom()}},scrollToBottom(){this.$nextTick((()=>{const e=this.$refs.messageList;e.scrollTop=e.scrollHeight}))}}},B=t(1241);const H=(0,B.A)(I,[["render",F],["__scopeId","data-v-aadde2e6"]]);var S=H}}]);
//# sourceMappingURL=921.7c55f272.js.map